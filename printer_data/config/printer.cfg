# This file contains common pin mappings for the BIGTREETECH Octopus Max EZ.
# To use this config, the firmware should be compiled for the
# STM32H723 with a "128KiB bootloader", "25 MHz crystal",
# and one of:
# Communication interface: "USB (on PA11/PA12)",
# Communication interface: "CAN bus (on PD0/PD1)", or
# Communication interface: "USB to CAN bus bridge (USB on PA11/PA12))" and CAN bus interface: "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

#=====================================================
# MACROS
#=====================================================
[include macros.cfg]
[include Fan.cfg]
[include TMC Autotune.cfg]
[exclude_object]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include temp_sensors.cfg]
[include z_tilt.cfg]
[include beacon.cfg]
[include LED.cfg]
[include resonance_tester.cfg]
[include input_shaper.cfg]
[include BedMesh.cfg]
[include AFC/*.cfg]
[include Hydra.cfg]

#=====================================================
# VIRTUAL SD CARD
#=====================================================
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes

#=====================================================
# MCU ID
#=====================================================
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_3F003D001051313236343430-if00
[mcu EBBCan]
canbus_uuid: e75929009724
[mcu U2C]
canbus_uuid: 2246f0775ddc

####################################################################
# 	X/Y Stepper Settings
#####################################################################

########################################
# X Stepper on Motor1 (A Motor)
########################################
# Motor-1
[stepper_x]
step_pin: PC13
dir_pin: PC14
enable_pin: !PE6
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:PB5
position_min: -13
position_endstop: -13
position_max: 370
homing_speed: 150
high_precision_step_compress: True

[tmc5160 stepper_x]
cs_pin: PG14
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 2.1
interpolate: false
sense_resistor: 0.022

########################################
# Y Stepper on Motor2 (B Motor)
########################################
# Motor-2
[stepper_y]
step_pin: PE4
dir_pin: PE5
enable_pin: !PE3
microsteps: 16
rotation_distance: 40
endstop_pin: PF0
position_endstop: 385
position_max: 385
homing_speed: 150
high_precision_step_compress: True

[tmc5160 stepper_y]
cs_pin: PG13
spi_software_mosi_pin: PE14
spi_software_miso_pin: PE13
spi_software_sclk_pin: PE12
run_current: 2.1
interpolate: false
sense_resistor: 0.022

########################################
# EXTRUDER
########################################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 35.1
gear_ratio: 60:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: MAX31865
pwm_cycle_time: 0.00417
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2
min_extrude_temp: 180
min_temp: 0
max_temp: 400
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
pressure_advance: 0.03
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 400 
high_precision_step_compress: True

[tmc2209 extruder]
uart_pin: EBBCan: PA15
interpolate: true
run_current: 0.85 
sense_resistor: 0.11 

########################################
# IDLE TIMEOUT
########################################
[idle_timeout]
timeout: 172800

########################################
# HEATER BED
########################################
[heater_bed]
heater_pin: PF6
sensor_pin: PB1 # TB
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 27
#pid_ki: 0.08
#pid_kd: 0
min_temp: 0
max_temp: 120

#=====================================================
# Force Move
#=====================================================
[force_move]
enable_force_move: True

#=====================================================
# PRINTER LIMITS
#=====================================================
[printer]
kinematics: corexy
max_velocity: 600
max_accel: 10000
max_z_velocity: 7.5
max_z_accel: 150
square_corner_velocity: 5.0

#=====================================================
# SHAKETUNE
#=====================================================
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 290.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 19.556
#*# pid_ki = 2.155
#*# pid_kd = 44.371
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 30.789
#*# pid_ki = 0.901
#*# pid_kd = 263.053
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 330.0
#*# min_y = 50.0
#*# max_y = 330.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5541259851883393,
#*# 	  1.9238778035382154,
#*# 	  0.7966415648937822,
#*# 	  0.2555204429745642,
#*# 	  0.19162571634216555,
#*# 	  0.39407850274250766,
#*# 	  -0.03243201753232501,
#*# 	  -0.3809846905209281,
#*# 	  0.09017808884539479,
#*# 	  0.2104506014261941
#*# model_domain = 1.8646727978632946e-07,1.9361380188170298e-07
#*# model_range = 0.199792,4.999792
#*# model_temp = 23.151680
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.009833, 0.005457, -0.005777, -0.016688, -0.023602, -0.028432, -0.032905, -0.034961, -0.042505, -0.044948, -0.045056, -0.049323, -0.055890, -0.057459, -0.057260, -0.055708, -0.060374, -0.053717, -0.052481, -0.049606, -0.046797, -0.043597, -0.036495, -0.025285, -0.017156
#*# 	0.010616, 0.003559, -0.006910, -0.016567, -0.021571, -0.025312, -0.029117, -0.030362, -0.042431, -0.042980, -0.044057, -0.046066, -0.052378, -0.055234, -0.054491, -0.055459, -0.054957, -0.054292, -0.051472, -0.046750, -0.047273, -0.043307, -0.035586, -0.026679, -0.021184
#*# 	0.014203, 0.006851, -0.002928, -0.012438, -0.017694, -0.016084, -0.022238, -0.030977, -0.036658, -0.040180, -0.040244, -0.044473, -0.048350, -0.050470, -0.050518, -0.051106, -0.049907, -0.049445, -0.048413, -0.046094, -0.045541, -0.039674, -0.034282, -0.028735, -0.018713
#*# 	0.012429, 0.006783, -0.001153, -0.011345, -0.015825, -0.017339, -0.022051, -0.033027, -0.037051, -0.043426, -0.041198, -0.042930, -0.047143, -0.047948, -0.048050, -0.046500, -0.046942, -0.046371, -0.047426, -0.048128, -0.046064, -0.041814, -0.037019, -0.029905, -0.018914
#*# 	0.009602, 0.002790, -0.002479, -0.010190, -0.018811, -0.023505, -0.027543, -0.034252, -0.041030, -0.043370, -0.043222, -0.042457, -0.045220, -0.045322, -0.043809, -0.043811, -0.043750, -0.048077, -0.046402, -0.047141, -0.048950, -0.045489, -0.036470, -0.024473, -0.016399
#*# 	0.016888, 0.012581, 0.002655, -0.007179, -0.013421, -0.018150, -0.024079, -0.027790, -0.039266, -0.039005, -0.039363, -0.039518, -0.040321, -0.040044, -0.038994, -0.038671, -0.041982, -0.038637, -0.044010, -0.044745, -0.045131, -0.042963, -0.034243, -0.023681, -0.013776
#*# 	0.013072, 0.010627, 0.004175, -0.005618, -0.011684, -0.015092, -0.023490, -0.029388, -0.037461, -0.040087, -0.038820, -0.038725, -0.037780, -0.037786, -0.037046, -0.037401, -0.042443, -0.039657, -0.045473, -0.046203, -0.047522, -0.043007, -0.033673, -0.024082, -0.012737
#*# 	0.014027, 0.005208, -0.000845, -0.008260, -0.011848, -0.019595, -0.023206, -0.029698, -0.032840, -0.039257, -0.039749, -0.039497, -0.041332, -0.041992, -0.041896, -0.039314, -0.041032, -0.043921, -0.044218, -0.047598, -0.048012, -0.045919, -0.037809, -0.027072, -0.016593
#*# 	0.012269, 0.004092, -0.002444, -0.008232, -0.013303, -0.018660, -0.022025, -0.029109, -0.030632, -0.034363, -0.035349, -0.036839, -0.038439, -0.035637, -0.036703, -0.035678, -0.035037, -0.041839, -0.042454, -0.045844, -0.046902, -0.044824, -0.037773, -0.026584, -0.015532
#*# 	0.014072, 0.008314, 0.000735, -0.003763, -0.012854, -0.016971, -0.025015, -0.032759, -0.030792, -0.030409, -0.030720, -0.035221, -0.034386, -0.036666, -0.036850, -0.037277, -0.039182, -0.042266, -0.043475, -0.045495, -0.047536, -0.045137, -0.040526, -0.032195, -0.022024
#*# 	0.009744, 0.004801, -0.004117, -0.009010, -0.014581, -0.023418, -0.029120, -0.029604, -0.036784, -0.034619, -0.035944, -0.038003, -0.038825, -0.037443, -0.037404, -0.037444, -0.043304, -0.040880, -0.045322, -0.046698, -0.046326, -0.044799, -0.037594, -0.028681, -0.020637
#*# 	0.012552, 0.004313, -0.001047, -0.007480, -0.010262, -0.024301, -0.030792, -0.028711, -0.035161, -0.035808, -0.038726, -0.039866, -0.042691, -0.041484, -0.040030, -0.041097, -0.041908, -0.043956, -0.045833, -0.044432, -0.041601, -0.040921, -0.035533, -0.028388, -0.021555
#*# 	0.010832, 0.003317, -0.002976, -0.009388, -0.016600, -0.021361, -0.026877, -0.035588, -0.037007, -0.040460, -0.043888, -0.047674, -0.046187, -0.043499, -0.041643, -0.041012, -0.041549, -0.046038, -0.047199, -0.042921, -0.037391, -0.032737, -0.029317, -0.023667, -0.012878
#*# 	0.009697, 0.003433, -0.002466, -0.012252, -0.019564, -0.022156, -0.027350, -0.035370, -0.034817, -0.039250, -0.044024, -0.048352, -0.050712, -0.050937, -0.047369, -0.046682, -0.046194, -0.050789, -0.048860, -0.045830, -0.043860, -0.040607, -0.036027, -0.028750, -0.019107
#*# 	0.003069, -0.005212, -0.013317, -0.020943, -0.023167, -0.027881, -0.029409, -0.030892, -0.035165, -0.042760, -0.049365, -0.047634, -0.051511, -0.049191, -0.049808, -0.048834, -0.050724, -0.053447, -0.052817, -0.052685, -0.048660, -0.043497, -0.034227, -0.025586, -0.018042
#*# 	0.008713, -0.001277, -0.011621, -0.014794, -0.023229, -0.025757, -0.024818, -0.023324, -0.031343, -0.036550, -0.040705, -0.043736, -0.043322, -0.047510, -0.045062, -0.043309, -0.043637, -0.045039, -0.049459, -0.049571, -0.047891, -0.045935, -0.039689, -0.031626, -0.022704
#*# 	0.005676, -0.002556, -0.014061, -0.020418, -0.027487, -0.022655, -0.021874, -0.021637, -0.029215, -0.035833, -0.043213, -0.046315, -0.043288, -0.045704, -0.045484, -0.041369, -0.041395, -0.042613, -0.048933, -0.051024, -0.049125, -0.044431, -0.038179, -0.028588, -0.019221
#*# 	0.001090, -0.009599, -0.015782, -0.030124, -0.026827, -0.029594, -0.028865, -0.029728, -0.030606, -0.037140, -0.042758, -0.041941, -0.049296, -0.046201, -0.046525, -0.045063, -0.043494, -0.043842, -0.044155, -0.046911, -0.047161, -0.048512, -0.044595, -0.037043, -0.027762
#*# 	-0.006188, -0.016268, -0.024015, -0.024453, -0.022680, -0.025228, -0.026865, -0.028723, -0.030490, -0.036103, -0.040388, -0.040406, -0.041463, -0.042595, -0.041115, -0.041558, -0.040421, -0.044197, -0.044664, -0.047834, -0.047711, -0.046076, -0.040304, -0.034824, -0.027835
#*# 	-0.002519, -0.010909, -0.018516, -0.012895, -0.023721, -0.018993, -0.022844, -0.025929, -0.020384, -0.023479, -0.028248, -0.031347, -0.030104, -0.035906, -0.031394, -0.031346, -0.033601, -0.033428, -0.032766, -0.034759, -0.035941, -0.037791, -0.034214, -0.028829, -0.019079
#*# 	-0.006672, -0.013442, -0.016721, -0.017385, -0.020306, -0.019748, -0.022905, -0.018016, -0.022314, -0.021844, -0.024753, -0.025299, -0.027381, -0.026971, -0.027732, -0.026313, -0.028718, -0.028204, -0.030784, -0.033188, -0.031978, -0.027544, -0.024151, -0.016654, -0.009963
#*# 	-0.004586, -0.013819, -0.017616, -0.024884, -0.014286, -0.026161, -0.024211, -0.020168, -0.025025, -0.020368, -0.020568, -0.020294, -0.027474, -0.022376, -0.030595, -0.028311, -0.028243, -0.029610, -0.032046, -0.035123, -0.031290, -0.031000, -0.026349, -0.021565, -0.014151
#*# 	-0.010830, -0.016749, -0.021613, -0.018529, -0.023674, -0.014467, -0.016231, -0.021452, -0.019611, -0.022754, -0.023286, -0.024196, -0.017812, -0.021787, -0.015775, -0.018042, -0.018990, -0.024722, -0.031587, -0.033852, -0.031003, -0.024598, -0.016573, -0.011578, -0.001461
#*# 	-0.008449, -0.011251, -0.004895, -0.015595, -0.024619, -0.021585, -0.018181, -0.023292, -0.014876, -0.014373, -0.017358, -0.018245, -0.019621, -0.019549, -0.014966, -0.014042, -0.015521, -0.021546, -0.022239, -0.029581, -0.029832, -0.024584, -0.018075, -0.011031, -0.000576
#*# 	-0.009778, -0.010108, -0.018932, -0.014270, -0.012124, -0.023234, -0.016241, -0.018776, -0.018989, -0.018222, -0.017692, -0.019201, -0.018169, -0.012391, -0.013376, -0.011799, -0.014909, -0.018261, -0.022358, -0.028566, -0.022605, -0.014282, -0.009531, 0.001633, 0.017167
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 40.0
#*# max_x = 320.0
#*# min_y = 40.0
#*# max_y = 320.0
